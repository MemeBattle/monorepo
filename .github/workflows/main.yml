name: 'Build, push and deploy docker images'

on:
  push:
    branches: [ configure_ci/cd ]
  pull_request:
    branches: [ configure_ci/cd ]

jobs:

  prepare-base-image:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: Login to docker registry
      run: docker login -u yerlankussainov -p kolbasa21 docker.io
    - name: Build base docker image
      run: docker build -t yerlankussainov/test-repo:base .
    - name: Push base docker image
      run: docker push yerlankussainov/test-repo:base

  ligretto-frontend-image:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: Login to docker registry
      run: docker login -u yerlankussainov -p kolbasa21 docker.io
    - name: Build frontend docker image
      run: docker build -t yerlankussainov/test-repo:ligretto-frontend ./apps/ligretto-recovery
    - name: Push frontend docker image
      run: docker push yerlankussainov/test-repo:ligretto-frontend

  ligretto-backend-image:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: Login to docker registry
      run: docker login -u yerlankussainov -p kolbasa21 docker.io
    - name: Build backend docker image
      run: docker build -t yerlankussainov/test-repo:ligretto-backend ./apps/ligretto-backend
    - name: Push backend docker image
      run: docker push yerlankussainov/test-repo:ligretto-backend

  ligretto-ui-image:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: Login to docker registry
      run: docker login -u yerlankussainov -p kolbasa21 docker.io
    - name: Build base docker image
      run: docker ui -t yerlankussainov/test-repo:ligretto-ui ./apps/ligretto-ui
    - name: Push base docker image
      run: docker ui yerlankussainov/test-repo:ligretto-ui